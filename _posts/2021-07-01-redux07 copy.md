---
title: "20210701 Redux07 : " #제목
category: #카테고리
tag: #태그
  - Redux
toc: true #옆에 목차
---

> # Redux 07

<br/>

<p align="center">
<img src="../assets/img/redux_logo.png" width="400px" height="400px">
</p>

<br/>
<br/>
<br/>

> # redux-actions 활용과 느낌

<br/>

## 기존 환경

<br/>

- redux-actions를 사용하는 경우, 기본적으로 다른 여러가지 패키지들과 사용하게 된다.
  - redux-actions : 리덕스 액션스는 덕스패턴을 만들때 편하게 작성시켜 코드를 좀더 깔끔하게 해준다.
  - react-redux : redux와 react를 연결할 때 쓰는 Provider, 그리고 react에서 state의 값을 가져오거나, 변경하고자 할때 요청을 useSeletor, useDispatch를 통해서 쉽게 사용할 수 있게함
  - redux-thunk : 비동기 작업을 Action으로 수행하고, 해당 작업을 통해 가져온 데이터 같은 것을 redux에 반영하게 할 수 있음
  - redux-devtools-extension : 리덕스 작업시 브라우저에서 어떻게 처리되는지 볼수 있게 추적해주고, 브라우저에서도 개발 tool이 아주 잘 되어 있음

<br/>
<br/>
<br/>

> ## redux-actions 사용 전

<br/>

- redux-thunk, react-redux, redux-devtools-extension을 사용하는 것은 똑같음
- 그러나, Type 작성, actionCreator 작성, defaultState작성, Reducer 작성 등의 한개의 모듈안에 엄청난 코드가 들어가게 된다.
  - 단지 외부에서 데이터를 요청해서 가져오는 비동기 작업 1번 했을 뿐인데, start - success - fail 이렇게 3가지 경우의 수로 나누어 state 변경(dispatch) 처리를 해줘야 한다.
- 그렇기 때문에, redux를 쓰면서 너무 긴 코드와 반복, 중복이 난무하는데 어떻게 해야 하나 생각했다.
  - 기존에 만들어 놓은 instagram clone 프로젝트를 redux화 시킬려고 했는데 워낙 쓰이는 변수도 많은데, 이걸 구현하려면 이렇게 코드양이 많은 구조의 redux를 사용해야 한다고 생각니 엄두가 나지도 않았다.
  - 그래서 redux-actions에 발을 들여 어떤지 사용해 보고, 숙달 시키려고 노력했다.

```js
import axios from "axios";

// Action Types
// thunk
const GET_USERS_START = "redux-start/users/GET_USERS_START";
const GET_USERS_SUCCESS = "redux-start/users/GET_USERS_SUCCESS";
const GET_USERS_FAIL = "redux-start/users/GET_USERS_FAIL";

// ActionsCreator
export function getUsersStart() {
  return {
    type: GET_USERS_START,
  };
}

export function getUsersSuccess(data) {
  return {
    type: GET_USERS_SUCCESS,
    data,
  };
}

export function getUsersFail(error) {
  return {
    type: GET_USERS_FAIL,
    error,
  };
}

function sleep(ms) {
  return new Promise((resolve) => {
    setTimeout(() => {
      resolve();
    }, ms);
  });
}

// defaultState
const initialState = {
  loading: false,
  data: [],
  error: null,
};

// Reducer
export default function reducer(state = initialState, action) {
  // thunk
  if (action.type === GET_USERS_START) {
    return {
      ...state,
      loading: true,
      error: null,
    };
  }

  if (action.type === GET_USERS_SUCCESS) {
    return {
      ...state,
      loading: false,
      data: action.data,
    };
  }

  if (action.type === GET_USERS_FAIL) {
    return {
      ...state,
      loading: false,
      error: action.error,
    };
  }

  return state;
}

// Thunk ActionCreator : 비동기 작업
export function getUsersThunk() {
  return async (dispatch, getState, { history }) => {
    try {
      console.log(history);
      dispatch(getUsersStart());
      // API가 빨리 끝나서 분석을 위해서 sleep을 줌
      await sleep(1000);
      const res = await axios.get("https://api.github.com/users");
      dispatch(getUsersSuccess(res.data));
      history.push("/");
    } catch (error) {
      dispatch(getUsersFail(error));
    }
  };
}
```

<br/>
<br/>
<br/>

> ## redux-actions 사용 후

<br/>

- 활용해서 작성해 보았지만, **prefix를 작성할 때 편한 것 말고는 딱히 크게 코드양을 줄어드는 것도 아닌것 같았다.**
- 어쨌거나, actionCreator를 작성해야 했다.
  - 이때 actionsCreator와 reducer가 중복되는 곳이 많은데 이렇게 밖에 못줄이나 생각이 들어 아쉽긴 했다.
- **대신, 기존에 사용하던 환경에서 action, reducer 작성 방식만 달라져서 reducerCombine 이나, middleware 설정은 건드리지 않아서 좋았다.**

```js
import axios from "axios";
import { createActions, handleActions } from "redux-actions";

// ActionsCreator (redux-actions)
const { getUsersStart, getUsersSuccess, getUsersFail } = createActions(
  {
    GET_USERS_SUCCESS: (data) => data,
    GET_USERS_FAIL: (error) => error,
  },
  "GET_USERS_START",
  {
    prefix: "redux-start/users",
  }
);

// defaultState
const initialState = {
  loading: false,
  data: [],
  error: null,
};

// handleActions
// handleActions(reducerMap, defaultState[, options])
const reducer = handleActions(
  {
    GET_USERS_START: (state) => ({
      ...state,
      loading: true,
    }),
    GET_USERS_SUCCESS: (state, action) => ({
      ...state,
      loading: false,
      data: action.payload,
    }),
    GET_USERS_FAIL: (state, action) => ({
      ...state,
      loading: false,
      error: action.payload,
    }),
  },
  initialState,
  { prefix: "redux-start/users" }
);

export default reducer;

function sleep(ms) {
  return new Promise((resolve) => {
    setTimeout(() => {
      resolve();
    }, ms);
  });
}

// Thunk ActionCreator : 비동기 작업
export function getUsersThunk() {
  return async (dispatch, getState) => {
    try {
      dispatch(getUsersStart());
      await sleep(1000);
      const res = await axios.get("https://api.github.com/users");
      dispatch(getUsersSuccess(res.data));
      // history.push('/');
    } catch (error) {
      dispatch(getUsersFail(error));
    }
  };
}
```

<br/>
<br/>
<br/>

> ## redux-actions 사용법

<br/>

## createActions()

<br/>

- `createActions(actionMap, ...identityActions[, options])`

  - creatActions는 actionMap, identityActions에서 활용되는 `대문자 스네이크 케이스(UPPER_SNAKE_CASE)`를 알아서, Type으로 사용하고 이를 `camelCase` 형식으로 변경해서 creator 함수 명으로 사용됨
  - createActions에 넣는 인자는 총 3가지임

    - 근데, actionMap, identityActions 중에 하나만 단독으로 사용하게 되어도 매개변수 위치 상관 없이, 알아서 인식함

    <br/>

    - **actionMap 형식의 경우**는 action들을 넣은 객체(`{}`) 형태의 묶음으로 state 변환 요청으로 dispatch시 바꿀 데이터를 주는 경우 reducer에서 payload로 들어오는 것을 제어 할 수 있음
      - `getUsersSuccess()` creator를 사용해서 `getUserSuccess(data)` 처럼 데이터를 주는 경우
      - 받는 인자를 어떻게 가공해서 payload가 어떤 형태의 자료를 보낼지 결정
      - `GET_USERS_SUCCESS: (data, index, number) => {data: data, index: index, number: number}` 의 형식인 경우 payload는 `{data: data, index: index, number: number}`를 전달함으로 써,
      - reducer에서는 `{dataState: action.payload.data, indexState: action.payload.index, ...state}` 이런 형식으로 dispatch 받은 값을 storeState에 반영할 수 있음

    <br/>

    - **identityActions의 경우**에는 딱히 payload가 없거나, 가공해야 할 필요가 없는 경우 `""`를 활용한 string 형식으로 넣으면 알아서 해당 액션 함수를 만들어 줌

    <br/>

    - 마지막에 붙는 **options**는 필수는 아니고, `prefix`와 `namespace`를 설정할 수 있음
      - 객체 형태(`{}`)로 넣어서 값을 지정해주면 됨
      - `prefix` : ducks 패턴에 맞게 type을 변경해주기 위한 prefix를 설정 할 수 있음
      - `namespace`: ducks패턴 type 명에서 쓰이는 `/` (Seprator)를 변경 할 수 있음

```js
// ActionsCreator (redux-actions)
export const { getUsersStart, getUsersSuccess, getUsersFail } = createActions(
  {
    GET_USERS_SUCCESS: (data) => data,
    GET_USERS_FAIL: (error) => error,
  },
  "GET_USERS_START",
  {
    prefix: "redux-start/users",
  }
);
```
